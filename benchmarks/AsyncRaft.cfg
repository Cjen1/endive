INIT Init
\* INIT InitTestInv
NEXT Next
CONSTANTS
    n1 = n1
    n2 = n2
    n3 = n3
    v1 = v1
    Server = {n1, n2, n3}
    Follower = Follower
    Candidate = Candidate
    Leader = Leader
    Nil = Nil
    RequestVoteRequest = RequestVoteRequest
    RequestVoteResponse = RequestVoteResponse
    AppendEntriesRequest = AppendEntriesRequest
    AppendEntriesResponse = AppendEntriesResponse
    EqualTerm = EqualTerm
    LessOrEqualTerm = LessOrEqualTerm
    MaxTerm = 2
    MaxLogLen = 2
    MaxNumVoteMsgs = 0 \* disabled for now.
    n1 = n1
    n2 = n2
    n3 = n3

CONSTRAINT StateConstraint

\* VIEW view
SYMMETRY Symmetry
\* INVARIANT TypeOK

\* PROPERTY
\* Uncomment the previous line and add property names

INVARIANT
    Inv14_R0_0_I1_0
    Inv454_R0_0_I2_1
    \* H_RequestVoteResponseMsgsInTermUnique
    \* H_LeaderMatchIndexValidAppendEntries
    \* H_AppendEntriesRequestLogEntriesMustBeInLeaderLog
    \* H_RequestVoteQuorumInTermImpliesNoAppendEntriesInTerm
    \* H_CandidateInTermVotedForItself
    \* H_AppendEntriesResponseInTermImpliesSafeAtTerms
    H_VotesCantBeGrantedTwiceToCandidatesInSameTerm
    H_VoteGrantedImpliesVoteResponseMsgConsistent
    H_LeaderHasVotesGrantedQuorum
    H_VoteGrantedImpliesNodeSafeAtTerm
    \* TestInv
    \* TestInv2
    \* H_OnePrimaryPerTerm
    \* H_CandidateWithVotesGrantedInTermImplyNoOtherLeader
    \* H_LogTermsMonotonic
    \* H_CurrentTermAtLeastAsLargeAsLogTermsForPrimary
    \* H_CurrentTermAtLeastAsLargeAsLogTerms
    \* H_VotesCantBeGrantedTwiceToCandidatesInSameTerm
    \* H_PrimaryHasEntriesItCreated
    \* H_DivergentEntriesInAppendEntriesMsgsForRequestVoteQuorum
    \* H_LeaderHasEntriesCoveredByCommitIndexes

    \* H_LogMatchingInAppendEntriesMsgsLeaders

    \* H_VotedForNodeInTermImpliesNodeSafeAtTerm

    \* H_LogEntryInTermImpliesSafeAtTerm
    \* H_LogEntryInTermImpliesSafeAtTermAppendEntries

    \* H_LogEntryInTermImpliesSafeAtTermCandidate

    \* H_LogsLaterThanCommittedMustHaveCommitted

    \* H_LogEntryInTermImpliesSafeAtTermCandidateAppendEntries

    \* H_NoLogDivergenceAppendEntries

    \* H_RequestVoteRequestFromNodeImpliesSafeAtTerm

    \* H_NodesVotedInQuorumInTermImpliesNoAppendEntriesRequestsInTerm

    \* H_CandidateVotesGrantedInTermAreUnique
    \* H_CandidateWithVotesGrantedInTermImplyVotersSafeAtTerm
    \* H_CandidateWithVotesGrantedInTermImplyNoOtherLogsInTerm

    \* H_CandidateWithVotesGrantedInTermImplyNoAppendEntryLogsInTerm
    \* H_RequestVoteQuorumInTermImpliesNoAppendEntryLogsInTerm
    \* H_RequestVoteQuorumInTermImpliesNoOtherLogsOrLeadersInTerm

    \* H_LogTermsMonotonicAppendEntries
    \* H_CurrentTermAtLeastAsLargeAsLogTerms

    \* H_AppendEntriesRequestLogTermsNoGreaterThanSenderTerm
    \* H_LogMatching
    \* H_LogMatchingBetweenAppendEntriesMsgs
    \* H_VoteGrantedImpliesVoteResponseMsgConsistent

    \* H_LogEntryInTermDisablesEarlierCommits
    \* H_CommitIndexAtEntryImpliesExistsOnQuorum


    \* H_RequestVoteQuorumInTermImpliesNoOtherLeadersInTerm

    \* H_CandidateWithVotesGrantedImpliesNoAppendEntriesInTerm
    \* H_CandidateInTermVotedForItself

    \* H_LogEntryInTermImpliesSafeAtTermCandidate

    \* H_QuorumsSafeAtTerms
    \* H_LogEntryInTermImpliesSafeAtTerm
    \* H_LogEntryInTermImpliesSafeAtTermAppendEntries
    
    \* H_RequestVoteResponseTermsMatchSource

    \* H_PrimaryHasEntriesItCreatedAppendEntries

    \* H_CommitIndexBoundValid


    \* H_AppendEntriesNeverSentToSelf
    \* H_RequestVotesNeverSentToSelf

    \* H_AppendEntriesRequestLogEntriesMustBeInLeaderLog
    \* H_LeaderMatchIndexValidAppendEntries
    \* H_CandidateWithVotesGrantedInTermImplyVotersSafeAtTerm
    \* H_LeaderMatchIndexBound
    \* H_LeaderMatchIndexValid
    \* H_CommitIndexCoversEntryImpliesExistsOnQuorum

    \* H_VoteInGrantedImpliesVotedFor
    \* H_AppendEntriesRequestInTermImpliesSafeAtTerms
    \* H_AppendEntriesResponseInTermImpliesSafeAtTerms
    \* H_NodesVotedInQuorumInTermImpliesNoAppendEntriesRequestsInTerm
    \* \* H_RequestVoteQuorumInTermImpliesNoAppendEntriesRequestsInTerm
    \* H_RequestVoteResponseTermsMatchSource
    \* H_CandidateWithVotesGrantedInTermImplyVotersSafeAtTerm

    \* May need to double check that this actually holds.
    \* H_CommitIndexInAppendEntriesImpliesCommittedEntryExists
    \* H_LogMatchingInAppendEntriesMsgs
    \* H_LogMatchingBetweenAppendEntriesMsgs
    \* H_AppendEntriesRequestInTermImpliesSafeAtTerms
    \* H_SuccessfulRequestVoteQuorumInTermImpliesNoLogsInTerm

    \* H_DivergentEntriesInAppendEntriesMsgs

    \* H_AppendEntriesCommitIndexCannotBeLargerThanTheSender

    \* H_LeaderHasEntriesCoveredByCommitIndexes
    \* L1

    \* H_RequestVoteRequestFromNodeInTermImpliesVotedForSelf

    H_NoLogDivergence \* (SAFETY)


\* INVARIANT TestInv
\* PROPERTY TestInv

\* LeaderHasAllAckedValues
\* NoLogDivergence
